"use strict";(self.webpackChunk_grafana_ui=self.webpackChunk_grafana_ui||[]).push([[8070],{"../../.yarn/__virtual__/@grafana-data-virtual-0996183232/1/packages/grafana-data/src/text/sanitize.ts":function(De,F,p){p.d(F,{Is:function(){return ce},Nm:function(){return pe},Nw:function(){return le},Xv:function(){return K},cd:function(){return de},he:function(){return A},oT:function(){return fe},pQ:function(){return ue}});var f=p("../../../yarn/cache/@braintree-sanitize-url-npm-6.0.2-a8e98c2fde-6a9dfd4081.zip/node_modules/@braintree/sanitize-url/dist/index.js"),T=p("../../../yarn/cache/dompurify-npm-2.4.5-ce1b7c62a7-d6d3c3b320.zip/node_modules/dompurify/dist/purify.js"),k=p.n(T),P=p("../../../yarn/cache/xss-npm-1.0.14-eb6e57872e-77c6a60a5f.zip/node_modules/xss/lib/index.js"),R=p.n(P),b=Object.defineProperty,ae=Object.defineProperties,re=Object.getOwnPropertyDescriptors,L=Object.getOwnPropertySymbols,se=Object.prototype.hasOwnProperty,ie=Object.prototype.propertyIsEnumerable,E=(c,y,S)=>y in c?b(c,y,{enumerable:!0,configurable:!0,writable:!0,value:S}):c[y]=S,oe=(c,y)=>{for(var S in y||(y={}))se.call(y,S)&&E(c,S,y[S]);if(L)for(var S of L(y))ie.call(y,S)&&E(c,S,y[S]);return c},M=(c,y)=>ae(c,re(y));const Q=Object.keys(P.whiteList).reduce((c,y)=>{var S;return c[y]=(S=P.whiteList[y])==null?void 0:S.concat(["class","style"]),c},{}),N=new P.FilterXSS({whiteList:Q,css:{whiteList:M(oe({},P.getDefaultCSSWhiteList()),{"flex-direction":!0,"flex-wrap":!0,"flex-basis":!0,"flex-grow":!0,"flex-shrink":!0,"flex-flow":!0,gap:!0,order:!0,"justify-content":!0,"justify-items":!0,"justify-self":!0,"align-items":!0,"align-content":!0,"align-self":!0})}});function le(c){try{return k().sanitize(c,{USE_PROFILES:{html:!0},FORBID_TAGS:["form","input"]})}catch{return console.error("String could not be sanitized",c),K(c)}}function ue(c){return k().sanitize(c,{RETURN_TRUSTED_TYPE:!0,ADD_ATTR:["xmlns:atom","version","property","content"],ADD_TAGS:["rss","meta","channel","title","link","description","atom:link","item","pubDate","guid"],PARSER_MEDIA_TYPE:"application/xhtml+xml"})}function de(c){return k().sanitize(c,{RETURN_TRUSTED_TYPE:!0})}function A(c){try{return N.process(c)}catch{return console.error("String could not be sanitized",c),"Text string could not be sanitized"}}function ce(c){return k().sanitize(c,{USE_PROFILES:{svg:!0,svgFilters:!0}})}function pe(c){return(0,f.N)(c)}function fe(c){return/\u001b\[\d{1,2}m/.test(c)}function K(c){return String(c).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#39;").replace(/"/g,"&quot;")}},"./src/components/QueryField/QueryField.story.tsx":function(De,F,p){p.r(F),p.d(F,{Basic:function(){return B},default:function(){return Vt}});var f=p("../../../yarn/cache/react-npm-18.2.0-1eae08fee2-88e38092da.zip/node_modules/react/index.js"),T=p("../../../yarn/cache/@emotion-css-npm-11.11.2-dbfa42cf83-1edea109df.zip/node_modules/@emotion/css/dist/emotion-css.esm.js"),k=p("../../../yarn/cache/classnames-npm-2.3.2-d2fdae468d-2c62199789.zip/node_modules/classnames/index.js"),P=p.n(k),R=p("../../../yarn/cache/lodash-npm-4.17.21-6382451519-eb835a2e51.zip/node_modules/lodash/lodash.js"),b=p("../../.yarn/__virtual__/slate-plain-serializer-virtual-06b7dc64c6/2/yarn/cache/slate-plain-serializer-npm-0.7.13-18e29a2d32-835a8c2a09.zip/node_modules/slate-plain-serializer/lib/slate-plain-serializer.es.js"),ae=p("../../.yarn/__virtual__/slate-react-virtual-42539bd050/2/yarn/cache/slate-react-npm-0.22.10-eca32f2ffc-1ecddaf0f6.zip/node_modules/slate-react/lib/slate-react.es.js"),re=p("../grafana-e2e-selectors/src/selectors/index.ts"),L=p("../../.yarn/__virtual__/react-dom-virtual-5dcbe0c0ba/2/yarn/cache/react-dom-npm-18.2.0-dd675bca1c-7d323310be.zip/node_modules/react-dom/index.js"),se=p("../../.yarn/__virtual__/react-window-virtual-5cdf81870a/2/yarn/cache/react-window-npm-1.8.9-c5c7e1ab50-cefa232f4f.zip/node_modules/react-window/dist/index.esm.js"),ie=p("../../.yarn/__virtual__/@grafana-data-virtual-0996183232/1/packages/grafana-data/src/themes/context.tsx"),E=(t=>(t.GroupTitle="GroupTitle",t))(E||{}),oe=p("../../../yarn/cache/calculate-size-npm-1.1.1-466c9f6cd7-8f1bfad7a9.zip/node_modules/calculate-size/lib/index.js");const M=t=>t.reduce((e,{items:n,label:a})=>(e.push({label:a,kind:E.GroupTitle}),n.reduce((r,s)=>(r.push(s),r),e)),[]),Q=t=>t.reduce((e,n)=>e.length<n.label.length?n.label:e,""),N=(t,e,n)=>{const a=(0,oe.Z)(n,{font:t.typography.fontFamilyMonospace,fontSize:t.typography.bodySmall.fontSize,fontWeight:"normal"}),r=ue(a.width,t),s=le(a.height,t),l=de(s,e);return{listWidth:r,listHeight:l,itemHeight:s}},le=(t,e)=>{const n=e.spacing.gridSize*2;return t+n},ue=(t,e)=>{const n=e.spacing.gridSize*3,a=800;return Math.min(Math.max(t+n,200),a)},de=(t,e)=>{const n=Math.min(e.length,10),a=100,r=n*t;return Math.max(r,a)};var A=p("../../../yarn/cache/marked-npm-5.1.1-3219cf7472-e0c6d3a63d.zip/node_modules/marked/lib/marked.esm.js"),ce=p("../../.yarn/__virtual__/marked-mangle-virtual-94e24d47b6/2/yarn/cache/marked-mangle-npm-1.1.0-73f06bcb25-3897cb6b0e.zip/node_modules/marked-mangle/src/index.js"),pe=p("../../.yarn/__virtual__/@grafana-data-virtual-0996183232/1/packages/grafana-data/src/text/sanitize.ts"),fe=Object.defineProperty,K=Object.defineProperties,c=Object.getOwnPropertyDescriptors,y=Object.getOwnPropertySymbols,S=Object.prototype.hasOwnProperty,Fe=Object.prototype.propertyIsEnumerable,Se=(t,e,n)=>e in t?fe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,he=(t,e)=>{for(var n in e||(e={}))S.call(e,n)&&Se(t,n,e[n]);if(y)for(var n of y(e))Fe.call(e,n)&&Se(t,n,e[n]);return t},Le=(t,e)=>K(t,c(e));let j=!1;const me={headerIds:!1,pedantic:!1,gfm:!0,smartLists:!0,smartypants:!1,xhtml:!1,breaks:!1};function Me(t,e){j||(A.TU.use((0,ce.d)()),A.TU.setOptions(he({},me)),j=!0);let n;e?.breaks&&(n=Le(he({},me),{breaks:!0}));const a=(0,A.TU)(t||"",n);return e?.noSanitize?a:(0,pe.he)(a)}function zt(t,e){j||(marked.use(mangle()),marked.setOptions(he({},me)),j=!0);const n=marked(t||"");return e?.noSanitize?n:sanitizeTextPanelContent(n)}var ye=p("./src/themes/ThemeContext.tsx");const Qe=(t,e,n)=>({typeaheadItem:(0,T.iv)({label:"type-ahead-item",zIndex:11,padding:t.spacing(1,1,1,2),border:t.colors.border.medium,overflowY:"scroll",overflowX:"hidden",outline:"none",background:t.colors.background.secondary,color:t.colors.text.secondary,boxShadow:`0 0 20px ${t.v1.colors.dropdownShadow}`,visibility:n===!0?"visible":"hidden",width:"250px",minHeight:`${e+parseInt(t.spacing(.25),10)}px`,position:"relative",wordBreak:"break-word"})}),q=({item:t,height:e})=>{const n=t&&!!t.documentation,a=t?t.label:"",r=Me(t?.documentation),s=(0,ye.l4)(),l=Qe(s,e,n);return f.createElement("div",{className:(0,T.cx)([l.typeaheadItem])},f.createElement("b",null,a),f.createElement("hr",null),f.createElement("div",{dangerouslySetInnerHTML:{__html:r}}))};try{q.displayName="TypeaheadInfo",q.__docgenInfo={description:"",displayName:"TypeaheadInfo",props:{item:{defaultValue:null,description:"",name:"item",required:!0,type:{name:"CompletionItem"}},height:{defaultValue:null,description:"",name:"height",required:!0,type:{name:"number"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/components/Typeahead/TypeaheadInfo.tsx#TypeaheadInfo"]={docgenInfo:q.__docgenInfo,name:"TypeaheadInfo",path:"src/components/Typeahead/TypeaheadInfo.tsx#TypeaheadInfo"})}catch{}var Ne=p("../../.yarn/__virtual__/react-highlight-words-virtual-7d06772b2d/2/yarn/cache/react-highlight-words-npm-0.20.0-02e799bf4d-6794b6fe40.zip/node_modules/react-highlight-words/dist/main.js"),Ke=p.n(Ne);function je(t,e){const n=[];return t.forEach(a=>{n.push(a.start,a.end+1)}),n[0]!==0&&n.unshift(0),n[n.length-1]!==e&&n.push(e),n}const H=t=>{let{highlightParts:e,text:n,highlightClassName:a}=t;if(!e?.length)return null;let r=[],s=je(e,n.length),l=e[0].start===0;for(let o=1;o<s.length;o++){let i=s[o-1],u=s[o];r.push((0,f.createElement)(l?"mark":"span",{key:o-1,className:l?a:void 0},n.substring(i,u))),l=!l}return f.createElement("div",null,r)};try{H.displayName="PartialHighlighter",H.__docgenInfo={description:"",displayName:"PartialHighlighter",props:{text:{defaultValue:null,description:"",name:"text",required:!0,type:{name:"string"}},highlightParts:{defaultValue:null,description:"",name:"highlightParts",required:!0,type:{name:"HighlightPart[]"}},highlightClassName:{defaultValue:null,description:"",name:"highlightClassName",required:!0,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/components/Typeahead/PartialHighlighter.tsx#PartialHighlighter"]={docgenInfo:H.__docgenInfo,name:"PartialHighlighter",path:"src/components/Typeahead/PartialHighlighter.tsx#PartialHighlighter"})}catch{}const qe=t=>({typeaheadItem:(0,T.iv)({border:"none",background:"none",textAlign:"left",label:"type-ahead-item",height:"auto",fontFamily:t.typography.fontFamilyMonospace,padding:t.spacing(1,1,1,2),fontSize:t.typography.bodySmall.fontSize,textOverflow:"ellipsis",overflow:"hidden",zIndex:11,display:"block",whiteSpace:"nowrap",cursor:"pointer",transition:"color 0.3s cubic-bezier(0.645, 0.045, 0.355, 1), border-color 0.3s cubic-bezier(0.645, 0.045, 0.355, 1), background 0.3s cubic-bezier(0.645, 0.045, 0.355, 1), padding 0.15s cubic-bezier(0.645, 0.045, 0.355, 1)"}),typeaheadItemSelected:(0,T.iv)({label:"type-ahead-item-selected",backgroundColor:t.colors.background.secondary}),typeaheadItemMatch:(0,T.iv)({label:"type-ahead-item-match",color:t.v1.palette.yellow,borderBottom:`1px solid ${t.v1.palette.yellow}`,padding:"inherit",background:"inherit"}),typeaheadItemGroupTitle:(0,T.iv)({label:"type-ahead-item-group-title",color:t.colors.text.secondary,fontSize:t.typography.bodySmall.fontSize,lineHeight:t.typography.body.lineHeight,padding:t.spacing(1)})}),W=t=>{const e=(0,ye.wW)(qe),{isSelected:n,item:a,prefix:r,style:s,onMouseEnter:l,onMouseLeave:o,onClickItem:i}=t,u=n?(0,T.cx)([e.typeaheadItem,e.typeaheadItemSelected]):(0,T.cx)([e.typeaheadItem]),d=(0,T.cx)([e.typeaheadItemMatch]),v=(0,T.cx)([e.typeaheadItemGroupTitle]),h=a.label||"";return a.kind===E.GroupTitle?f.createElement("li",{className:v,style:s},f.createElement("span",null,h)):f.createElement("li",{role:"none"},f.createElement("button",{role:"menuitem",className:u,style:s,onMouseDown:i,onMouseEnter:l,onMouseLeave:o,type:"button"},a.highlightParts!==void 0?f.createElement(H,{text:h,highlightClassName:d,highlightParts:a.highlightParts}):f.createElement(Ke(),{textToHighlight:h,searchWords:[r??""],autoEscape:!0,highlightClassName:d})))};try{W.displayName="TypeaheadItem",W.__docgenInfo={description:"",displayName:"TypeaheadItem",props:{isSelected:{defaultValue:null,description:"",name:"isSelected",required:!0,type:{name:"boolean"}},item:{defaultValue:null,description:"",name:"item",required:!0,type:{name:"CompletionItem"}},style:{defaultValue:null,description:"",name:"style",required:!0,type:{name:"CSSProperties"}},prefix:{defaultValue:null,description:"",name:"prefix",required:!1,type:{name:"string"}},onClickItem:{defaultValue:null,description:"",name:"onClickItem",required:!1,type:{name:"((event: MouseEvent<Element, MouseEvent>) => void)"}},onMouseEnter:{defaultValue:null,description:"",name:"onMouseEnter",required:!1,type:{name:"(() => void)"}},onMouseLeave:{defaultValue:null,description:"",name:"onMouseLeave",required:!1,type:{name:"(() => void)"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/components/Typeahead/TypeaheadItem.tsx#TypeaheadItem"]={docgenInfo:W.__docgenInfo,name:"TypeaheadItem",path:"src/components/Typeahead/TypeaheadItem.tsx#TypeaheadItem"})}catch{}const Te=(t,e)=>t-e*Math.floor(t/e);class D extends f.PureComponent{constructor(){super(...arguments),this.listRef=(0,f.createRef)(),this.state={hoveredItem:null,typeaheadIndex:null,allItems:[],listWidth:-1,listHeight:-1,itemHeight:-1},this.componentDidMount=()=>{this.props.menuRef&&this.props.menuRef(this),document.addEventListener("selectionchange",this.handleSelectionChange);const e=M(this.props.groupedItems),n=Q(e),{listWidth:a,listHeight:r,itemHeight:s}=N(this.context,e,n);this.setState({listWidth:a,listHeight:r,itemHeight:s,allItems:e})},this.componentWillUnmount=()=>{document.removeEventListener("selectionchange",this.handleSelectionChange)},this.handleSelectionChange=()=>{this.forceUpdate()},this.componentDidUpdate=(e,n)=>{if(this.state.typeaheadIndex!==null&&n.typeaheadIndex!==this.state.typeaheadIndex&&this.listRef&&this.listRef.current){if(this.state.typeaheadIndex===1){this.listRef.current.scrollToItem(0);return}this.listRef.current.scrollToItem(this.state.typeaheadIndex)}if((0,R.isEqual)(e.groupedItems,this.props.groupedItems)===!1){const a=M(this.props.groupedItems),r=Q(a),{listWidth:s,listHeight:l,itemHeight:o}=N(this.context,a,r);this.setState({listWidth:s,listHeight:l,itemHeight:o,allItems:a,typeaheadIndex:null})}},this.onMouseEnter=e=>{this.setState({hoveredItem:e})},this.onMouseLeave=()=>{this.setState({hoveredItem:null})},this.moveMenuIndex=e=>{const n=this.state.allItems.length;if(n){const a=this.state.typeaheadIndex||0;let r=Te(a+e,n);this.state.allItems[r].kind===E.GroupTitle&&(r=Te(r+e,n)),this.setState({typeaheadIndex:r});return}},this.insertSuggestion=()=>{this.props.onSelectSuggestion&&this.state.typeaheadIndex!==null&&this.props.onSelectSuggestion(this.state.allItems[this.state.typeaheadIndex])}}get menuPosition(){if(!window.getSelection)return"";const e=window.getSelection(),n=e&&e.anchorNode;if(n&&n.parentElement){const a=n.parentElement.getBoundingClientRect(),r=window.scrollX,s=window.scrollY;return`position: absolute; display: flex; top: ${a.top+s+a.height+6}px; left: ${a.left+r-2}px`}return""}render(){const{prefix:e,isOpen:n=!1,origin:a}=this.props,{allItems:r,listWidth:s,listHeight:l,itemHeight:o,hoveredItem:i,typeaheadIndex:u}=this.state,d=i||u,v=r[i||u||0];return f.createElement(He,{origin:a,isOpen:n,style:this.menuPosition},f.createElement("ul",{role:"menu",className:"typeahead","data-testid":"typeahead"},f.createElement(se.t7,{ref:this.listRef,itemCount:r.length,itemSize:o,itemKey:h=>{const _=r&&r[h];return _?`${h}-${_.label}`:`${h}`},width:s,height:l},({index:h,style:_})=>{const g=r&&r[h];return g?f.createElement(W,{onClickItem:()=>this.props.onSelectSuggestion?this.props.onSelectSuggestion(g):{},isSelected:u===null?!1:r[u]===g,item:g,prefix:e,style:_,onMouseEnter:()=>this.onMouseEnter(h),onMouseLeave:this.onMouseLeave}):null})),d&&f.createElement(q,{height:l,item:v}))}}D.contextType=ie.N;class He extends f.PureComponent{constructor(e){super(e);const{index:n=0,origin:a="query",style:r}=e;this.node=document.createElement("div"),this.node.setAttribute("style",r),this.node.classList.add("slate-typeahead",`slate-typeahead-${a}-${n}`),document.body.appendChild(this.node)}componentWillUnmount(){document.body.removeChild(this.node)}render(){return this.props.isOpen?(this.node.setAttribute("style",this.props.style),this.node.classList.add("slate-typeahead--open"),L.createPortal(this.props.children,this.node)):(this.node.classList.remove("slate-typeahead--open"),null)}}try{D.displayName="Typeahead",D.__docgenInfo={description:"",displayName:"Typeahead",props:{origin:{defaultValue:null,description:"",name:"origin",required:!0,type:{name:"string"}},groupedItems:{defaultValue:null,description:"",name:"groupedItems",required:!0,type:{name:"CompletionItemGroup[]"}},prefix:{defaultValue:null,description:"",name:"prefix",required:!1,type:{name:"string"}},menuRef:{defaultValue:null,description:"",name:"menuRef",required:!1,type:{name:"((el: Typeahead) => void)"}},onSelectSuggestion:{defaultValue:null,description:"",name:"onSelectSuggestion",required:!1,type:{name:"((suggestion: CompletionItem) => void)"}},isOpen:{defaultValue:null,description:"",name:"isOpen",required:!1,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/components/Typeahead/Typeahead.tsx#Typeahead"]={docgenInfo:D.__docgenInfo,name:"Typeahead",path:"src/components/Typeahead/Typeahead.tsx#Typeahead"})}catch{}var V=p("../../.yarn/__virtual__/slate-virtual-e8ba9109cf/2/yarn/cache/slate-npm-0.47.9-61a6086a90-a128d1eaa4.zip/node_modules/slate/lib/slate.es.js");const We={document:{nodes:[{match:[{type:"paragraph"},{type:"code_block"},{type:"code_line"}]}]},inlines:{}},_e=(t,e)=>{const n=t.split(`
`).map(r=>V.gO.create({type:"code_line",nodes:[V.xv.create(r)]})),a=V.gO.create({data:{syntax:e},type:"code_block",nodes:n});return V.BB.create({nodes:[a]})},Oe=(t,e)=>{const n=_e(t,e);return V.B4.create({document:n})};function Ue(t,e){let n=0,a=t.indexOf(e);e=e.replace(/\s/g,"");const r=[];if(a!==-1)return{distance:0,found:!0,ranges:[{start:a,end:a+e.length-1}]};for(const s of e){const l=t.indexOf(s,a);if(l===-1)return{distance:1/0,ranges:[],found:!1};if(a!==-1&&(n+=l-a),a=l+1,r.length===0)r.push({start:l,end:l});else{const o=(0,R.last)(r);l===o.end+1?o.end++:r.push({start:l,end:l})}}return{distance:n,ranges:r,found:!0}}var ge=(t=>(t.Word="Word",t.Prefix="Prefix",t.Fuzzy="Fuzzy",t))(ge||{});const Ye={Word:(t,e)=>t.filter(n=>(n.filterText||n.label).includes(e)),Prefix:(t,e)=>t.filter(n=>(n.filterText||n.label).startsWith(e)),Fuzzy:(t,e)=>(e=e.toLowerCase(),t.filter(n=>{const{distance:a,ranges:r,found:s}=Ue(n.label.toLowerCase(),e);return s?(n.sortValue=a,n.highlightParts=r,!0):!1}))};var be="prism-token",Ge=Object.defineProperty,$e=Object.defineProperties,Ze=Object.getOwnPropertyDescriptors,Ie=Object.getOwnPropertySymbols,Xe=Object.prototype.hasOwnProperty,Je=Object.prototype.propertyIsEnumerable,Pe=(t,e,n)=>e in t?Ge(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,C=(t,e)=>{for(var n in e||(e={}))Xe.call(e,n)&&Pe(t,n,e[n]);if(Ie)for(var n of Ie(e))Je.call(e,n)&&Pe(t,n,e[n]);return t},U=(t,e)=>$e(t,Ze(e)),et=(t,e,n)=>new Promise((a,r)=>{var s=i=>{try{o(n.next(i))}catch(u){r(u)}},l=i=>{try{o(n.throw(i))}catch(u){r(u)}},o=i=>i.done?a(i.value):Promise.resolve(i.value).then(s,l);o((n=n.apply(t,e)).next())});const tt=250;function Y({onTypeahead:t,cleanText:e,onWillApplySuggestion:n,portalOrigin:a}){let r,s={groupedItems:[],typeaheadPrefix:"",typeaheadContext:"",typeaheadText:""};const l=(0,R.debounce)(nt,tt),o=i=>{s=C(C({},s),i)};return{onBlur:(i,u,d)=>(s=U(C({},s),{groupedItems:[]}),d()),onClick:(i,u,d)=>(s=U(C({},s),{groupedItems:[]}),d()),onKeyDown:(i,u,d)=>{const h=s.groupedItems.length;switch(i.key){case"Escape":{if(h)return i.preventDefault(),s=U(C({},s),{groupedItems:[]}),u.insertText("");break}case"ArrowDown":case"ArrowUp":if(h){i.preventDefault(),r.moveMenuIndex(i.key==="ArrowDown"?1:-1);return}break;case"Enter":{if(!(i.shiftKey||i.ctrlKey)&&h)return i.preventDefault(),r.insertSuggestion();break}case"Tab":{if(h)return i.preventDefault(),r.insertSuggestion();break}default:{i.key.length===1&&l(u,o,t,e);break}}return d()},commands:{selectSuggestion:(i,u)=>{const d=s.groupedItems;if(!d||!d.length)return i;const v=i.applyTypeahead(u);return l(i,o,t,e),v},applyTypeahead:(i,u)=>{let d=u.insertText||u.label;const v=u.kind==="function",h=u.move||0,_=h>0?h:0,g=h<0?-h:0,{typeaheadPrefix:I,typeaheadText:w,typeaheadContext:xe}=s;n&&(d=n(d,{groupedItems:s.groupedItems,typeaheadContext:xe,typeaheadPrefix:I,typeaheadText:w}));const J=u.deleteBackwards||I.length,ee=(e?e(w):w).length-I.length,te=w.indexOf(I),x=I&&(ee>0&&te>-1||d===w)&&!v?ee+te:0;if(d.match(/\n/)){const ne=_e(d);return i.deleteBackward(J).deleteForward(x).insertFragment(ne).focus(),i}return s=U(C({},s),{groupedItems:[]}),i.snapshotSelection().deleteBackward(J).deleteForward(x).insertText(d).moveForward(_).moveBackward(g).focus(),i}},renderEditor(i,u,d){if(u.value.selection.isExpanded)return d();const v=d();return f.createElement(f.Fragment,null,v,f.createElement(D,{menuRef:h=>r=h,origin:a,prefix:s.typeaheadPrefix,isOpen:!!s.groupedItems.length,groupedItems:s.groupedItems,onSelectSuggestion:u.selectSuggestion}))}}}const nt=(t,e,n,a)=>et(void 0,null,function*(){if(!n)return;const{value:r}=t,{selection:s}=r,l=r.document.getClosestBlock(r.focusBlock.key),o=r.selection.start.offset-1,i=l&&l.getDecorations(t),u=i?i.filter(m=>m.start.offset<=o&&m.end.offset>o&&m.type===be).toArray():[],d=i&&i.filter(m=>m.end.offset<=o&&m.type===be&&m.data.get("className").includes("label-key")).last(),v=d&&r.focusText.text.slice(d.start.offset,d.end.offset),h=u.map(m=>m.data.get("className")).join(" ").split(" ").filter(m=>m.length);let _=r.focusText.text,g=_.slice(0,s.focus.offset);u.length&&(_=r.focusText.text.slice(u[0].start.offset,u[0].end.offset),g=r.focusText.text.slice(u[0].start.offset,s.focus.offset));const I=g.match(/(?:!?=~?"?|")(.*)/);I?g=I[1]:a&&(g=a(g));const{suggestions:w,context:xe}=yield n({prefix:g,text:_,value:r,wrapperClasses:h,labelKey:v||void 0,editor:t}),J=w.map(m=>{if(!m.items)return m;const ee=m.searchFunctionType||(m.prefixMatch?ge.Prefix:ge.Word),te=Ye[ee];let O=C({},m);return g&&(m.skipFilter||(O.items=O.items.filter(x=>(x.filterText||x.label).length>=g.length),O.items=te(O.items,g)),O.items=O.items.filter(x=>{var ne;return!(x.insertText===g||((ne=x.filterText)!=null?ne:x.label)===g)})),m.skipSort||(O.items=(0,R.sortBy)(O.items,x=>x.sortText===void 0?x.sortValue!==void 0?x.sortValue:x.label:x.sortText||x.label)),O}).filter(m=>m.items&&m.items.length);e({groupedItems:J,typeaheadPrefix:g,typeaheadContext:xe,typeaheadText:_}),t.blur().focus()});try{Y.displayName="SuggestionsPlugin",Y.__docgenInfo={description:"",displayName:"SuggestionsPlugin",props:{onTypeahead:{defaultValue:null,description:"",name:"onTypeahead",required:!1,type:{name:"((typeahead: TypeaheadInput) => Promise<TypeaheadOutput>)"}},cleanText:{defaultValue:null,description:"",name:"cleanText",required:!1,type:{name:"((text: string) => string)"}},onWillApplySuggestion:{defaultValue:null,description:"",name:"onWillApplySuggestion",required:!1,type:{name:"((suggestion: string, state: SuggestionsState) => string)"}},portalOrigin:{defaultValue:null,description:"",name:"portalOrigin",required:!0,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/slate-plugins/suggestions.tsx#SuggestionsPlugin"]={docgenInfo:Y.__docgenInfo,name:"SuggestionsPlugin",path:"src/slate-plugins/suggestions.tsx#SuggestionsPlugin"})}catch{}function at({handler:t}){return{onKeyDown(e,n,a){return t&&e.key==="Enter"&&(e.shiftKey||e.ctrlKey)?(e.preventDefault(),t(e),n):a()}}}function rt(t){let e=t.length-t.trimLeft().length;if(e){let n=t[0];for(;--e;)n+=t[0];return n}return""}function st(){return{onKeyDown(t,e,n){const a=e.value;if(a.selection.isExpanded)return n();if(t.key==="Enter"){t.preventDefault();const{startBlock:r}=a,s=r.text,l=rt(s);return e.splitBlock().insertText(l).focus()}return n()}}}function it(){return{onKeyDown(t,e,n){const a=e.value;if(a.selection.isExpanded)return n();if(t.key==="k"&&t.ctrlKey){t.preventDefault();const r=a.anchorText.text,s=a.selection.anchor.offset,o=r.length-s;return e.deleteForward(o),!0}return n()}}}var G=p("../../../yarn/cache/is-hotkey-npm-0.2.0-c11e0b0bdb-97d295cfd8.zip/node_modules/is-hotkey/lib/index.js");const ot=(0,G.TB)("mod+l");function lt(){return{onKeyDown(t,e,n){if(ot(t)){t.preventDefault();const{focusBlock:a,document:r}=e.value;e.moveAnchorToStartOfBlock(),r.getNextBlock(a.key)?e.moveFocusToStartOfNextBlock():e.moveFocusToEndOfText()}else return n();return!0}}}const ut=(0,G.TB)("mod+["),dt=(0,G.TB)("shift+tab"),ct=(0,G.TB)("mod+]"),$="  ",pt=(t,e,n)=>{const{startBlock:a,endBlock:r,selection:{start:{offset:s,key:l},end:{offset:o,key:i}}}=e.value;if(b.Z.serialize(e.value)==="")return;t.preventDefault();const u=a.getFirstText();u&&s===0&&l===u.key&&o===u.text.length&&i===u.key||!a.equals(r)?ve(e,"right"):e.insertText($)},ve=(t,e)=>{const n=t.value.selection,a=t.value.document.getLeafBlocksAtRange(n).toArray();if(e==="left")for(const r of a){const s=r.text.length-r.text.trimLeft().length,l=r.getFirstText().key,o={anchor:{key:l,offset:s,path:[]},focus:{key:l,offset:s,path:[]}};t.deleteBackwardAtRange(V.e6.create(o),Math.min($.length,s))}else{const{startText:r}=t.value,s=r.text.slice(0,n.start.offset),l=/^\s*$/.test(s);for(const o of a)t.insertTextByKey(o.getFirstText().key,0,$);l&&t.moveStartBackward($.length)}};function ft(){return{onKeyDown(t,e,n){if(ut(t)||dt(t))t.preventDefault(),ve(e,"left");else if(ct(t))t.preventDefault(),ve(e,"right");else if(t.key==="Tab")pt(t,e,n);else return n();return!0}}}var ht=Object.defineProperty,mt=Object.defineProperties,yt=Object.getOwnPropertyDescriptors,Ee=Object.getOwnPropertySymbols,gt=Object.prototype.hasOwnProperty,vt=Object.prototype.propertyIsEnumerable,Ce=(t,e,n)=>e in t?ht(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,xt=(t,e)=>{for(var n in e||(e={}))gt.call(e,n)&&Ce(t,n,e[n]);if(Ee)for(var n of Ee(e))vt.call(e,n)&&Ce(t,n,e[n]);return t},St=(t,e)=>mt(t,yt(e));const Tt=(t,e,n)=>{if(!t.length)return;const a=t.slice(0,-1).join("").length+t.length-1;return t.join(`
`).slice(e,a+n)},we=t=>t?.replace(/[\uFEFF]/g,"");function _t(){const t={onCopy(e,n,a){e.preventDefault();const{document:r,selection:s}=n.value,{start:{offset:l},end:{offset:o}}=s,i=r.getLeafBlocksAtRange(s).toArray().map(d=>d.text),u=we(Tt(i,l,o));return u&&e.clipboardData&&e.clipboardData.setData("Text",u),!0},onPaste(e,n,a){if(e.preventDefault(),e.clipboardData){const r=we(e.clipboardData.getData("Text")),s=r?.split(`
`);if(s&&s.length){n.insertText(s[0]);for(const l of s.slice(1))n.splitBlock().insertText(l)}}return!0}};return St(xt({},t),{onCut(e,n,a){return t.onCopy(e,n,a),n.deleteAtRange(n.value.selection),!0}})}var Ot=p("./src/themes/mixins.ts");class Z extends f.PureComponent{constructor(e,n){super(e,n),this.lastExecutedValue=null,this.mounted=!1,this.editor=null,this.onChange=(o,i)=>{const u=o.document!==this.state.value.document,d=this.state.value;this.props.onRichValueChange&&this.props.onRichValueChange(o),this.setState({value:o},()=>{if(u){const v=b.Z.serialize(d)!==b.Z.serialize(o);v&&i&&this.runOnChangeAndRunQuery(),v&&!i&&this.runOnChangeDebounced()}})},this.runOnChange=()=>{const{onChange:o}=this.props,i=b.Z.serialize(this.state.value);o&&o(this.cleanText(i))},this.runOnRunQuery=()=>{const{onRunQuery:o}=this.props;o&&(o(),this.lastExecutedValue=this.state.value)},this.runOnChangeAndRunQuery=()=>{this.runOnChange(),this.runOnRunQuery()},this.handleBlur=(o,i,u)=>{const{onBlur:d}=this.props;if(d)d();else{const v=this.lastExecutedValue?b.Z.serialize(this.lastExecutedValue):"",h=b.Z.serialize(i.value);v!==h&&this.runOnChangeAndRunQuery()}return u()},this.runOnChangeDebounced=(0,R.debounce)(this.runOnChange,500);const{onTypeahead:a,cleanText:r,portalOrigin:s,onWillApplySuggestion:l}=e;this.plugins=[Y({onTypeahead:a,cleanText:r,portalOrigin:s,onWillApplySuggestion:l}),at({handler:this.runOnChangeAndRunQuery}),st(),it(),lt(),ft(),_t(),...e.additionalPlugins||[]].filter(o=>o),this.state={suggestions:[],typeaheadContext:null,typeaheadPrefix:"",typeaheadText:"",value:Oe(e.query||"",e.syntax)}}componentDidMount(){this.mounted=!0}componentWillUnmount(){this.mounted=!1}componentDidUpdate(e,n){const{query:a,syntax:r,syntaxLoaded:s}=this.props;if(!e.syntaxLoaded&&s&&this.editor){const o=this.editor.insertText(" ").deleteBackward(1);this.onChange(o.value,!0)}const{value:l}=this.state;a!==e.query&&a!==b.Z.serialize(l)&&this.setState({value:Oe(a||"",r)})}cleanText(e){return e.replace(/[\r]/g,"")}render(){const{disabled:e,theme:n}=this.props,a=P()("slate-query-field__wrapper",{"slate-query-field__wrapper--disabled":e}),r=bt(n);return f.createElement("div",{className:(0,T.cx)(a,r.wrapper)},f.createElement("div",{className:"slate-query-field","aria-label":re.wl.components.QueryField.container},f.createElement(ae.ML,{ref:s=>this.editor=s,schema:We,autoCorrect:!1,readOnly:this.props.disabled,onBlur:this.handleBlur,onClick:this.props.onClick,onChange:s=>{this.onChange(s.value,!1)},placeholder:this.props.placeholder,plugins:this.plugins,spellCheck:!1,value:this.state.value})))}}const z=(0,ye.HE)(Z);z.defaultProps={onBlur:()=>{}};const bt=t=>{const e=(0,Ot.SV)(t);return{wrapper:(0,T.iv)({"&:focus-within":e})}};try{Z.displayName="UnThemedQueryField",Z.__docgenInfo={description:`Renders an editor field.
Pass initial value as initialQuery and listen to changes in props.onValueChanged.
This component can only process strings. Internally it uses Slate Value.
Implement props.onTypeahead to use suggestions, see PromQueryField.tsx as an example.`,displayName:"UnThemedQueryField",props:{additionalPlugins:{defaultValue:null,description:"",name:"additionalPlugins",required:!1,type:{name:"Plugin<Editor>[]"}},cleanText:{defaultValue:null,description:"",name:"cleanText",required:!1,type:{name:"((text: string) => string)"}},disabled:{defaultValue:null,description:"",name:"disabled",required:!1,type:{name:"boolean"}},query:{defaultValue:null,description:"",name:"query",required:!1,type:{name:"string | null"}},onRunQuery:{defaultValue:null,description:"",name:"onRunQuery",required:!1,type:{name:"(() => void)"}},onBlur:{defaultValue:{value:"() => {}"},description:"",name:"onBlur",required:!1,type:{name:"(() => void)"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!1,type:{name:"((value: string) => void)"}},onRichValueChange:{defaultValue:null,description:"",name:"onRichValueChange",required:!1,type:{name:"((value: Value) => void)"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!1,type:{name:"EventHook<MouseEvent<Element, MouseEvent>>"}},onTypeahead:{defaultValue:null,description:"",name:"onTypeahead",required:!1,type:{name:"((typeahead: TypeaheadInput) => Promise<TypeaheadOutput>)"}},onWillApplySuggestion:{defaultValue:null,description:"",name:"onWillApplySuggestion",required:!1,type:{name:"((suggestion: string, state: SuggestionsState) => string)"}},placeholder:{defaultValue:null,description:"",name:"placeholder",required:!1,type:{name:"string"}},portalOrigin:{defaultValue:null,description:"",name:"portalOrigin",required:!0,type:{name:"string"}},syntax:{defaultValue:null,description:"",name:"syntax",required:!1,type:{name:"string"}},syntaxLoaded:{defaultValue:null,description:"",name:"syntaxLoaded",required:!1,type:{name:"boolean"}},theme:{defaultValue:null,description:"",name:"theme",required:!0,type:{name:"GrafanaTheme2"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/components/QueryField/QueryField.tsx#UnThemedQueryField"]={docgenInfo:Z.__docgenInfo,name:"UnThemedQueryField",path:"src/components/QueryField/QueryField.tsx#UnThemedQueryField"})}catch{}try{z.displayName="QueryField",z.__docgenInfo={description:"",displayName:"QueryField",props:{onChange:{defaultValue:null,description:"",name:"onChange",required:!1,type:{name:"((value: string) => void)"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!1,type:{name:"EventHook<MouseEvent<Element, MouseEvent>>"}},placeholder:{defaultValue:null,description:"",name:"placeholder",required:!1,type:{name:"string"}},onBlur:{defaultValue:{value:"() => {}"},description:"",name:"onBlur",required:!1,type:{name:"(() => void)"}},disabled:{defaultValue:null,description:"",name:"disabled",required:!1,type:{name:"boolean"}},additionalPlugins:{defaultValue:null,description:"",name:"additionalPlugins",required:!1,type:{name:"Plugin<Editor>[]"}},cleanText:{defaultValue:null,description:"",name:"cleanText",required:!1,type:{name:"((text: string) => string)"}},query:{defaultValue:null,description:"",name:"query",required:!1,type:{name:"string | null"}},onRunQuery:{defaultValue:null,description:"",name:"onRunQuery",required:!1,type:{name:"(() => void)"}},onRichValueChange:{defaultValue:null,description:"",name:"onRichValueChange",required:!1,type:{name:"((value: Value) => void)"}},onTypeahead:{defaultValue:null,description:"",name:"onTypeahead",required:!1,type:{name:"((typeahead: TypeaheadInput) => Promise<TypeaheadOutput>)"}},onWillApplySuggestion:{defaultValue:null,description:"",name:"onWillApplySuggestion",required:!1,type:{name:"((suggestion: string, state: SuggestionsState) => string)"}},portalOrigin:{defaultValue:null,description:"",name:"portalOrigin",required:!0,type:{name:"string"}},syntax:{defaultValue:null,description:"",name:"syntax",required:!1,type:{name:"string"}},syntaxLoaded:{defaultValue:null,description:"",name:"syntaxLoaded",required:!1,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/components/QueryField/QueryField.tsx#QueryField"]={docgenInfo:z.__docgenInfo,name:"QueryField",path:"src/components/QueryField/QueryField.tsx#QueryField"})}catch{}var It=Object.defineProperty,Pt=Object.defineProperties,Et=Object.getOwnPropertyDescriptors,ke=Object.getOwnPropertySymbols,Ct=Object.prototype.hasOwnProperty,wt=Object.prototype.propertyIsEnumerable,Re=(t,e,n)=>e in t?It(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,X=(t,e)=>{for(var n in e||(e={}))Ct.call(e,n)&&Re(t,n,e[n]);if(ke)for(var n of ke(e))wt.call(e,n)&&Re(t,n,e[n]);return t},Ve=(t,e)=>Pt(t,Et(e)),kt=(t,e,n)=>new Promise((a,r)=>{var s=i=>{try{o(n.next(i))}catch(u){r(u)}},l=i=>{try{o(n.throw(i))}catch(u){r(u)}},o=i=>i.done?a(i.value):Promise.resolve(i.value).then(s,l);o((n=n.apply(t,e)).next())}),ze,Be,Ae;const Rt={title:"Data Source/QueryField",component:z,parameters:{controls:{exclude:["onTypeahead","onChange","onBlur","onClick","onRunQuery","onRichValueChange","onWillApplySuggestion","portalOrigin","additionalPlugins","cleanText","syntax","syntaxLoaded"]}},argTypes:{query:{control:"text"}}},B=t=>f.createElement(z,X({},t));B.args={onTypeahead:t=>kt(void 0,null,function*(){return{suggestions:[]}}),query:"Query text",placeholder:"Placeholder text",disabled:!1};var Vt=Rt;B.parameters=Ve(X({},B.parameters),{docs:Ve(X({},(ze=B.parameters)==null?void 0:ze.docs),{source:X({originalSource:"(args: Omit<QueryFieldProps, 'theme'>) => <QueryField {...args} />"},(Ae=(Be=B.parameters)==null?void 0:Be.docs)==null?void 0:Ae.source)})})}}]);
